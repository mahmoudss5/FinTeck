sequenceDiagram
    autonumber
    actor User as User (React)
    participant Auth as AuthProvider
    participant API as Spring Boot API
    participant JWT as JWT Filter
    participant Service as WalletService
    participant DB as MySQL Database

    Note over User, API: 1. User Login Flow
    User->>Auth: Enter credentials
    Auth->>API: POST /api/v1/auth/login
    API->>DB: Validate credentials
    DB-->>API: User found
    API-->>Auth: Return JWT token
    Auth->>Auth: Store token in localStorage

    Note over User, API: 2. Fund Transfer Flow
    User->>Auth: Initiate transfer
    Auth->>API: PUT /wallets/api/transfer
    API->>JWT: Validate JWT token
    
    alt Invalid Token
        JWT-->>User: 401 Unauthorized
    else Valid Token
        JWT->>Service: Process transfer request
        Service->>DB: Fetch sender wallet with version
        DB-->>Service: Wallet data + version

        alt Insufficient Balance
            Service-->>User: 400 Insufficient Funds
        else Balance OK
            Service->>DB: BEGIN TRANSACTION
            Service->>DB: UPDATE sender balance (version check)
            
            alt Version Conflict
                DB-->>Service: OptimisticLockException
                Service-->>User: 409 Conflict - Retry
            else Version OK
                Service->>DB: UPDATE receiver balance
                Service->>DB: INSERT transaction record
                Service->>DB: COMMIT
                DB-->>Service: Success
                Service-->>User: 200 OK - Transfer Complete
            end
        end
    end